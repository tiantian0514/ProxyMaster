<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V2Rayè®¢é˜…è§£ææµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .input-group {
            margin: 15px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .input-group textarea {
            height: 100px;
            resize: vertical;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-secondary {
            background: #6c757d;
        }
        .btn-secondary:hover {
            background: #545b62;
        }
        .result {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .node-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .node-header {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .node-details {
            font-size: 12px;
            color: #666;
        }
        .error {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: #155724;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª V2Rayè®¢é˜…è§£ææµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•è¯´æ˜</h2>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•V2Rayè®¢é˜…é“¾æ¥çš„è§£æåŠŸèƒ½ã€‚æ‚¨å¯ä»¥ï¼š</p>
        <ul>
            <li>æµ‹è¯•å•ä¸ªèŠ‚ç‚¹URLçš„è§£æ</li>
            <li>æµ‹è¯•å®Œæ•´è®¢é˜…å†…å®¹çš„è§£æ</li>
            <li>æŸ¥çœ‹è§£æç»“æœå’Œç”Ÿæˆçš„é…ç½®</li>
            <li>ä¸‹è½½ç”Ÿæˆçš„V2Rayé…ç½®æ–‡ä»¶</li>
        </ul>
        <p><strong>æ³¨æ„ï¼š</strong>è¿™åªæ˜¯è§£ææµ‹è¯•ï¼Œä¸ä¼šå®é™…è¿æ¥åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚</p>
    </div>

    <div class="test-section">
        <h2>ğŸ”— å•ä¸ªèŠ‚ç‚¹URLæµ‹è¯•</h2>
        <div class="input-group">
            <label>èŠ‚ç‚¹URLï¼š</label>
            <textarea id="nodeUrl" placeholder="ç²˜è´´VMessã€VLESSã€Trojanæˆ–Shadowsocksé“¾æ¥..."></textarea>
        </div>
        <button class="btn" onclick="parseNodeUrl()">è§£æèŠ‚ç‚¹</button>
        <button class="btn btn-secondary" onclick="loadExampleNode()">åŠ è½½ç¤ºä¾‹</button>
        
        <div id="nodeResult"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“¦ è®¢é˜…å†…å®¹æµ‹è¯•</h2>
        <div class="input-group">
            <label>è®¢é˜…å†…å®¹ï¼ˆBase64ç¼–ç æˆ–åŸå§‹å†…å®¹ï¼‰ï¼š</label>
            <textarea id="subscriptionContent" placeholder="ç²˜è´´è®¢é˜…å†…å®¹..."></textarea>
        </div>
        <button class="btn" onclick="parseSubscription()">è§£æè®¢é˜…</button>
        <button class="btn btn-secondary" onclick="loadExampleSubscription()">åŠ è½½ç¤ºä¾‹</button>
        
        <div id="subscriptionResult"></div>
    </div>

    <div class="test-section">
        <h2>âš™ï¸ é…ç½®æ–‡ä»¶ç”Ÿæˆ</h2>
        <p>é€‰æ‹©ä¸€ä¸ªå·²è§£æçš„èŠ‚ç‚¹æ¥ç”ŸæˆV2Rayé…ç½®æ–‡ä»¶ï¼š</p>
        <div id="configGeneration"></div>
    </div>

    <script src="v2ray-manager.js"></script>
    <script>
        let manager;
        let parsedNodes = [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            manager = new V2RaySubscriptionManager();
        });

        // è§£æå•ä¸ªèŠ‚ç‚¹URL
        function parseNodeUrl() {
            const url = document.getElementById('nodeUrl').value.trim();
            const resultDiv = document.getElementById('nodeResult');
            
            if (!url) {
                resultDiv.innerHTML = '<div class="error">è¯·è¾“å…¥èŠ‚ç‚¹URL</div>';
                return;
            }

            try {
                const node = manager.parseNodeUrl(url);
                if (node) {
                    resultDiv.innerHTML = `
                        <div class="success">âœ… è§£ææˆåŠŸ</div>
                        <div class="node-item">
                            <div class="node-header">${node.name}</div>
                            <div class="node-details">
                                <strong>ç±»å‹ï¼š</strong>${node.type}<br>
                                <strong>åœ°å€ï¼š</strong>${node.address}:${node.port}<br>
                                ${node.type === 'vmess' ? `<strong>IDï¼š</strong>${node.id}<br><strong>åŠ å¯†ï¼š</strong>${node.security}<br>` : ''}
                                ${node.type === 'shadowsocks' ? `<strong>åŠ å¯†æ–¹æ³•ï¼š</strong>${node.method}<br>` : ''}
                            </div>
                        </div>
                        <button class="btn" onclick="generateConfig(${JSON.stringify(node).replace(/"/g, '&quot;')})">ç”Ÿæˆé…ç½®æ–‡ä»¶</button>
                    `;
                    parsedNodes = [node];
                    updateConfigGeneration();
                } else {
                    resultDiv.innerHTML = '<div class="error">âŒ æ— æ³•è§£ææ­¤URLï¼Œè¯·æ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ è§£æé”™è¯¯: ${error.message}</div>`;
            }
        }

        // è§£æè®¢é˜…å†…å®¹
        function parseSubscription() {
            const content = document.getElementById('subscriptionContent').value.trim();
            const resultDiv = document.getElementById('subscriptionResult');
            
            if (!content) {
                resultDiv.innerHTML = '<div class="error">è¯·è¾“å…¥è®¢é˜…å†…å®¹</div>';
                return;
            }

            try {
                const nodes = manager.parseSubscriptionContent(content);
                if (nodes.length > 0) {
                    let html = `<div class="success">âœ… è§£ææˆåŠŸï¼Œå…±æ‰¾åˆ° ${nodes.length} ä¸ªèŠ‚ç‚¹</div>`;
                    
                    nodes.forEach((node, index) => {
                        html += `
                            <div class="node-item">
                                <div class="node-header">${node.name}</div>
                                <div class="node-details">
                                    <strong>ç±»å‹ï¼š</strong>${node.type} | 
                                    <strong>åœ°å€ï¼š</strong>${node.address}:${node.port}
                                </div>
                            </div>
                        `;
                    });
                    
                    resultDiv.innerHTML = html;
                    parsedNodes = nodes;
                    updateConfigGeneration();
                } else {
                    resultDiv.innerHTML = '<div class="error">âŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„èŠ‚ç‚¹é…ç½®</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ è§£æé”™è¯¯: ${error.message}</div>`;
            }
        }

        // æ›´æ–°é…ç½®ç”ŸæˆåŒºåŸŸ
        function updateConfigGeneration() {
            const div = document.getElementById('configGeneration');
            if (parsedNodes.length === 0) {
                div.innerHTML = '<p style="color: #666;">è¯·å…ˆè§£æä¸€äº›èŠ‚ç‚¹</p>';
                return;
            }

            let html = '<div style="margin-bottom: 15px;">';
            parsedNodes.forEach((node, index) => {
                html += `
                    <button class="btn btn-secondary" onclick="generateConfig(${JSON.stringify(node).replace(/"/g, '&quot;')})">
                        ç”Ÿæˆ ${node.name} é…ç½®
                    </button>
                `;
            });
            html += '</div>';
            
            div.innerHTML = html;
        }

        // ç”Ÿæˆé…ç½®æ–‡ä»¶
        function generateConfig(node) {
            try {
                const config = manager.generateV2RayConfig(node);
                const configJson = JSON.stringify(config, null, 2);
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const blob = new Blob([configJson], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `v2ray-${node.name.replace(/[^a-zA-Z0-9]/g, '_')}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                // æ˜¾ç¤ºé…ç½®å†…å®¹
                const div = document.getElementById('configGeneration');
                div.innerHTML += `
                    <div class="result">
                        <strong>ç”Ÿæˆçš„V2Rayé…ç½®æ–‡ä»¶ï¼š</strong>
                        ${configJson}
                    </div>
                `;
            } catch (error) {
                alert('ç”Ÿæˆé…ç½®å¤±è´¥: ' + error.message);
            }
        }

        // åŠ è½½ç¤ºä¾‹èŠ‚ç‚¹
        function loadExampleNode() {
            // è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹VMessé“¾æ¥ï¼ˆæ— æ•ˆçš„ï¼Œä»…ç”¨äºæµ‹è¯•è§£æï¼‰
            const exampleVmess = 'vmess://' + btoa(JSON.stringify({
                "v": "2",
                "ps": "æµ‹è¯•èŠ‚ç‚¹-ç¾å›½",
                "add": "example.com",
                "port": "443",
                "id": "12345678-1234-1234-1234-123456789abc",
                "aid": "0",
                "scy": "auto",
                "net": "ws",
                "type": "none",
                "host": "",
                "path": "/path",
                "tls": "tls"
            }));
            
            document.getElementById('nodeUrl').value = exampleVmess;
        }

        // åŠ è½½ç¤ºä¾‹è®¢é˜…
        function loadExampleSubscription() {
            // åˆ›å»ºç¤ºä¾‹è®¢é˜…å†…å®¹
            const exampleNodes = [
                'vmess://' + btoa(JSON.stringify({
                    "v": "2",
                    "ps": "ç¤ºä¾‹èŠ‚ç‚¹1-é¦™æ¸¯",
                    "add": "hk.example.com",
                    "port": "443",
                    "id": "12345678-1234-1234-1234-123456789abc",
                    "aid": "0",
                    "scy": "auto",
                    "net": "ws",
                    "tls": "tls"
                })),
                'vmess://' + btoa(JSON.stringify({
                    "v": "2", 
                    "ps": "ç¤ºä¾‹èŠ‚ç‚¹2-ç¾å›½",
                    "add": "us.example.com",
                    "port": "80",
                    "id": "87654321-4321-4321-4321-cba987654321",
                    "aid": "0",
                    "scy": "auto",
                    "net": "tcp"
                }))
            ];
            
            const subscriptionContent = btoa(exampleNodes.join('\n'));
            document.getElementById('subscriptionContent').value = subscriptionContent;
        }
    </script>
</body>
</html> 