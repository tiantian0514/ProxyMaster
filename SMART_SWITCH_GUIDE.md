# 🔄 智能切换功能详细指南

## 📖 功能概述

**智能切换**是ProxyMaster的核心功能，它能够根据你访问的网站自动选择最合适的代理配置，让你无需手动切换代理就能享受最佳的网络体验。

## 🎯 主要功能

### 1. 自动规则匹配
- 当你访问网站时，系统会自动检查是否有匹配的切换规则
- 支持多种匹配方式：
  - **域名匹配**：如 `*.google.com` 匹配所有Google子域名
  - **URL匹配**：匹配完整的URL路径
  - **通配符匹配**：使用 `*` 和 `?` 进行灵活匹配
  - **正则表达式**：支持复杂的高级匹配规则

### 2. 智能学习机制
- 当你手动切换代理后，系统会自动为当前域名创建切换规则
- 下次访问相同域名时会自动应用相同的代理设置
- 减少重复的手动操作，提升使用体验

### 3. 优先级管理
- 支持规则优先级设置（1-1000）
- 数值越大优先级越高
- 当多个规则匹配时，优先应用高优先级规则

## 🚀 使用方法

### 启用智能切换

1. **通过Popup界面**：
   - 点击扩展图标打开popup
   - 点击"🔄 智能切换"按钮
   - 系统会自动跳转到设置页面的自动切换规则标签

2. **通过设置页面**：
   - 打开扩展选项页面
   - 切换到"高级设置"标签
   - 勾选"启用智能切换"选项
   - 点击"保存设置"

### 创建自动切换规则

#### 方法一：手动创建规则
1. 在选项页面点击"自动切换规则"标签
2. 点击"➕ 新建规则"按钮
3. 填写规则信息：
   - **规则名称**：便于识别的名称，如"Google服务"
   - **匹配类型**：选择匹配方式
   - **匹配模式**：输入匹配条件
   - **使用代理**：选择要使用的代理配置
   - **优先级**：设置规则优先级（1-1000）

#### 方法二：自动学习（推荐）
1. 访问需要代理的网站
2. 手动切换到合适的代理配置
3. 系统会自动为该域名创建切换规则
4. 下次访问时会自动应用相同代理

## 📋 规则示例

### 常用网站规则配置

```
规则名称: Google服务
匹配类型: 域名匹配
匹配模式: *.google.com
使用代理: US-高速
优先级: 200

规则名称: YouTube视频
匹配类型: 域名匹配  
匹配模式: *.youtube.com
使用代理: HK-专线
优先级: 200

规则名称: GitHub开发
匹配类型: 域名匹配
匹配模式: github.com
使用代理: 直连
优先级: 100

规则名称: 社交媒体
匹配类型: 通配符匹配
匹配模式: *twitter.com*
使用代理: US-高速
优先级: 150
```

### 高级规则示例

```
规则名称: HTTPS Google搜索
匹配类型: 正则表达式
匹配模式: ^https://www\.google\.com/search.*
使用代理: US-高速
优先级: 300

规则名称: 特定路径
匹配类型: URL匹配
匹配模式: https://example.com/api/*
使用代理: SG-API
优先级: 250
```

## ⚡ 性能优化

### 快速切换机制
- 在网络请求发出前就完成代理切换
- 缓存设置信息，减少重复查询
- 防止重复处理相同URL

### 智能保护机制
- **手动优先**：在同一域名内，手动设置的代理优先级高于自动切换
- **标签页隔离**：每个标签页可以有独立的代理状态
- **错误处理**：切换失败时有完善的错误处理机制

## 🔧 高级设置

### 自动回退功能
- 启用"自动回退到直连"选项
- 当访问的网站没有匹配任何代理规则时，自动切换回直连模式
- 避免不必要的代理使用，提升访问速度

### 性能监控
- 启用"性能监控"选项
- 实时监控代理切换次数和网络请求统计
- 帮助优化规则配置

## 🛠️ 故障排除

### 常见问题

1. **智能切换不生效**
   - 检查是否启用了智能切换功能
   - 确认规则配置是否正确
   - 查看浏览器控制台是否有错误信息

2. **规则匹配不准确**
   - 检查匹配模式是否正确
   - 确认规则优先级设置
   - 使用测试功能验证规则

3. **切换速度慢**
   - 检查代理服务器连接状态
   - 减少不必要的规则数量
   - 优化规则优先级设置

### 调试方法

1. **查看控制台日志**：
   - 按F12打开开发者工具
   - 查看Console标签页的日志信息
   - 搜索"ProxyMaster"相关日志

2. **使用测试功能**：
   - 在选项页面测试代理连接
   - 验证规则匹配是否正确

## 📊 最佳实践

### 规则设计原则

1. **简单优先**：优先使用域名匹配，避免复杂的正则表达式
2. **优先级合理**：常用网站设置较高优先级
3. **定期清理**：删除不再需要的规则
4. **测试验证**：新建规则后及时测试效果

### 代理配置建议

1. **命名规范**：使用地区代码开头，如"US-高速"、"HK-专线"
2. **用途明确**：为不同用途配置专门的代理
3. **备用方案**：配置多个相同地区的代理作为备用

## 🔗 相关功能

- [代理配置管理](options.html#profiles)
- [统计分析](options.html#stats)
- [高级设置](options.html#settings)

## 📝 更新日志

### v1.0.4 新增功能
- ✅ 添加URL锚点导航支持
- ✅ 智能切换按钮直接跳转到规则配置页面
- ✅ 支持浏览器前进/后退按钮导航
- ✅ 优化页面加载和标签页切换体验

---

**提示**：智能切换功能需要一些时间来学习你的使用习惯，建议在初期手动设置一些常用网站的规则，后续系统会自动学习并优化。 